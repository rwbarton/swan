\documentclass[11pt]{article}

\usepackage[margin=1in]{geometry}
\usepackage{tikz-cd}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{amsmath,amsthm,amssymb,mathrsfs,mathabx}
\usepackage{enumitem}
\usepackage{csquotes}
\usepackage{color}
\usepackage{parskip}
\usepackage{hyperref}
\usepackage{fixltx2e}
\usepackage{tcolorbox}
\usepackage{listings}
\usepackage{cleveref}

\newcommand{\R}{\mathbb{R}}
\newcommand{\remph}[1]{\textcolor{red}{#1}}
\newcommand{\TODO}{\remph{TODO}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\Mat}{\operatorname{Mat}}
\newcommand{\Vect}{\operatorname{Vect}}
\newcommand{\fgProj}{\operatorname{fgProj}}
\newcommand{\Shv}{\operatorname{Shv}}
\newcommand{\RHom}[3]{\Hom_{{#1}\text{-Mod}}({#2}, {#3})}
\newcommand{\im}{\operatorname{im}}
\renewcommand{\ker}{\operatorname{ker}}
\mathchardef\mhyphen="2D
\newcommand{\Mod}{\mhyphen\operatorname{Mod}}
\newcommand{\wt}{\widetilde}
\newcommand{\id}{\operatorname{id}}
\newcommand{\mbf}{\mathbf}

\theoremstyle{plain}
\newtheorem{lemma}{Lemma}[section]
\newtheorem{theorem}{Theorem}[section]

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{example}{Example}[section]

\bibliographystyle{plainurl}

\usepackage{color}
\definecolor{keywordcolor}{rgb}{0.7, 0.1, 0.1}   % red
\definecolor{tacticcolor}{rgb}{0.1, 0.2, 0.6}    % blue
\definecolor{commentcolor}{rgb}{0.4, 0.4, 0.4}   % grey
\definecolor{symbolcolor}{rgb}{0.0, 0.1, 0.6}    % blue
\definecolor{sortcolor}{rgb}{0.1, 0.5, 0.1}      % green
\definecolor{attributecolor}{rgb}{0.7, 0.1, 0.1} % red

\usepackage{listings}
\def\lstlanguagefiles{lstlean.tex}
\lstset{language=lean,breakatwhitespace,xleftmargin=0pt, basicstyle=\ttfamily\small}
\usepackage{stmaryrd}
\newcommand{\B}{\mathbb{B}}
\newcommand{\lil}{\lstinline}
\newcommand{\N}{\mathbb{N}}
\newcommand{\cl}{\operatorname{cl}}
\newcommand{\supp}{\operatorname{supp}}

\begin{document}

\title{Swan's theorem}
\author{Jesse Han}
\date{\today}

\maketitle

\begin{abstract}
We give an account of Swan's theorem on vector bundles over a compact Hausdorff space.
\end{abstract}

\section*{Introduction}
% TODO

\section{Preliminaries}
Throughout this section, we fix a topological space \(X\).


\begin{definition}\label{def:cts-functions}
  We define \(C(X)\) to be the ring of continuous \(\R\)-valued functions on \(X\).
\end{definition}

\begin{definition}\label{def:support}
  Let \(g : C(X)\). We define the \textbf{support} of \(g\), denoted \(\supp(g)\), to be the following set:
  \[ \cl \left( \{ x : X \mid g(x) \neq 0 \} \right).\]
\end{definition}

% other reference: https://www.math.wisc.edu/~robbin/partitions_of_unity.pdf
% TODO(jesse): refactor this definition in terms of families of spaces to reflect the formalization.
\begin{definition}[\cite{kelley2017general}, Problem 5W]\label{def:partition-of-unity}
  A \textbf{partition of unity} on \(X\) comprises the following data:
  \begin{enumerate}[label={(\roman*)}]
  \item An indexing type \(I\).
  \item An indexing function \(g : I \to C(X)\).
  \item An open neighborhood function \(U : X \to 2^X\).
  \end{enumerate}

  These data must satisfy the following properties:

  \begin{enumerate}[label={(\alph*)}]
  \item For every \(i : I\), and every \(x : X\), \(g(i)(x) \geq 0\).
  \item For every \(x : X\), \(U(x)\) is open and \(x \in U(x)\).
  \item For every \(x : X\), there is a finite set \(I_x \subseteq I\) such that for every \(g \notin I_x\), \(g\) vanishes on \(U(x)\).
  \item For every \(x : X\), \(\displaystyle \sum_{i : I} g(i)(x) = 1\).
  \end{enumerate}
\end{definition}

\begin{definition}\label{def:subordinate}
  Let \(\mathscr{P} := \langle I, g, U \rangle\) be a partition of unity on \(X\). Let \(\mathscr{U} := \{U_j\}_{j : J}\) be an open cover of \(X\). We define the following property of \(\mathscr{P}\). We say that \(\mathscr{P}\) is \textbf{subordinate to} \(\mathscr{U}\) if for every \(i : I\), there exists a \(j : J\) such that \(\supp(g(i)) \subseteq U_j\).
\end{definition}

\begin{definition}\label{def:normal-space}
  Let \(Y\) be a topological space. We define the following property of \(Y\). We say that \(Y\) is \textbf{normal} if for every closed set \(V_1 \subseteq Y\) and every closed set \(V_2 \subseteq Y\), there exists an open neighborhood \(U_1 \supseteq V_1\) and an open neighborhood of \(U_2 \supseteq V_2\) such that \(U_1 \cap U_2 = \emptyset\).
\end{definition}

\begin{lemma}\label{lemma:compact-hausdorff-normal}
  Let \(X\) be a space. If \(X\) is compact Hausdorff, then \(X\) is normal.
\end{lemma}

\begin{proof}
  Fix \(V_1, V_2\) closed subsets of \(X\). For every \(x \in V_1\), and for all \(y \in V_2\), let \(U_{1,x,y}\) and \(U_{2,x,y}\) be the neighborhoods of \(x\) and \(y\) which witness Hausdorffness. The union \(\bigcup_{x,y} U_{1,x,y}\) forms an open cover of \(V_1\) which can be refined, by compactness, to a subcover indexed by (say) \((x_i, y_i)_{1 \leq i, j \leq n}\). For each \(x_i\) among \(x_1, \dots, x_n\), let \(W_i\) be the union \(\bigcup_{y} U_{1, x_i, y}\), which forms an open cover of \(V_2\). Then by construction, \(\bigcap_{1 \leq i \leq n} W_i\) and \(\bigcup_{1 \leq i,j \leq n} U_{1,x_i, y_j}\) are open neighborhoods of \(V_2\) and \(V_1\) that are disjoint.
\end{proof}

\begin{definition}\label{def:locally-finite-open-cover}
  Let \(\mathscr{U} := \{U_j\}_{j : J}\) be an open cover of \(X\). We define the following property of \(\mathscr{U}\). We say that \(\mathscr{U}\) is \textbf{locally finite} if for every \(x : X\), there exists a neighborhood \(U_x \ni x\) such that \(U_x\) meets only finitely many members of \(\mathscr{U}\).
\end{definition}

\begin{definition}\label{def:separated-by-function}
  Let \(V_1\) and \(V_2\) be closed sets of \(X\). Let \(g : C(X)\). We define the following property of \(g\). We say that \textbf{\(g\) separates \(V_1\) and \(V_2\)} if \(g\) has constant value \(c_1\) on \(V_1\) and \(g\) has constant value \(c_2\) on \(V_2\), such that \(c_1 \neq c_2\).
\end{definition}

The proofs of the next two lemmas can be found in Chapter 12 of Bredon \cite{bredon2013topology}. % TODO(jesse): come back to this

\begin{lemma}[Urysohn's lemma]\label{lemma:urysohn}
  If \(X\) is a normal space, then for every two disjoint closed sets \(V_1, V_2\), there exists a \(g : C(X)\) such that \(g\) separates \(V_1\) and \(V_2\).
\end{lemma}

\begin{lemma} \label{lemma:subordinate-partition-of-unity}
  Suppose that \(X\) is normal. Let \(\mathscr{U} := \{U_j\}_{j : J}\) be a locally finite open cover of \(X\). Then there exists a partition of unity on \(X\) subordinate to \(\mathscr{U}\).
\end{lemma}

\section{Vector bundles}
For the rest of this document, we fix a compact Hausdorff space \(X\).
% TODO: rephrase in terms of fiber functions
\begin{definition}

\label{def:vector-bundle}
 A (real) \textbf{vector bundle over \(X\)} comprises the following data:
  \begin{enumerate}[label={(\roman*)}]
  \item A topological space \(E\), called the \textbf{total space},
  \item a map of topological spaces \(E \overset{p}{\to} X\),
  \item on every \emph{fiber} \(E_x := p^{-1}(x)\), the structure of an \(\R\)-vector space on \(E_x\), and
  \item for every \(x : X\), an open neighborhood \(x \in U_x \subseteq X\), an \(n_x : \N\), and a homeomorphism \(\Phi_x : U_x \times \R^{n_x} \to p^{-1}(U)\),
  \end{enumerate}

  satisfying the following properties:
\begin{enumerate}[label={(\alph*)}]
  \item For every \(x : X\), the dimension of the vector space \(E_x\) is finite,
  \item \label{local-triviality} for every \(x : X\), \(\Phi_x\) is linear on every fiber, and satisfies \(p \circ \Phi_x = (\pi_1 : U_x \times \R^{n_x} \twoheadrightarrow U_x)\).
\end{enumerate}
\end{definition}

\begin{example}\label{example-trivial-bundle}
  The property \Cref{local-triviality} is called \textbf{local triviality}. Accordingly, for every \(n : \N\), we define the \textbf{trivial bundle} of rank \(n\) to be
  \[
    X \times \R^n \overset{\pi_1}{\twoheadrightarrow} X.
  \]
\end{example}

% \begin{example}\label{example-tangent-bundle}
%   Suppose that \(X\) additionally has the structure of a smooth manifold. The \textbf{tangent bundle} of \(X\) is defined as follows: the total space is sigma-type of all tangent spaces at all points of \(X\).

%   \TODO(jesse): describe the topology, smooth structure, etc.
% \end{example}

\begin{definition}\label{def:rank}
  Let \(E \overset{p}{\to} X\) be a vector bundle. Let \(x : X\). The \textbf{rank of \(E\) at \(x\)} is the dimension of the vector space \(E_x\).
\end{definition}

\begin{lemma}\label{lemma:rank-locally-constant}
  Rank is a locally constant function. That is, for every \(x : X\), there is a neighborhood \(V_{x}\) of \(x\) such that the rank of \(E\) is constant on \(V_x\).
\end{lemma}

\begin{proof}
  This follows immediately from local triviality (the neighborhood \(V_{x}\) is given by fixing trivialization data).
\end{proof}

\begin{definition} \label{def:vector-bundle-homomorphism}
  Let \(E_1 \overset{p_1}{\to} X\) and \(E_2 \overset{p_2}{\to} X\) be vector bundles over \(X\).
  A \textbf{vector bundle morphism} is a map \(f : E_1 \to E_2\) over \(X\) such that for every \(x : X\), \(E_{1,x} \overset{f}{\to} E_{2,f(x)}\) is also a map of vector spaces.
\end{definition}

\begin{definition} \label{def:category-vector-bundles}
  We define \(\Vect(X)\), the category of vector bundles over \(X\), to be the category whose objects are the vector bundles over \(X\) and whose morphisms are the vector bundle morphisms.
\end{definition}

\begin{definition}\label{def:global-sections}
  Let \(E \overset{p}{\to} X\) be a vector bundle over \(X\). The \textbf{global sections} of \(E\) are the set of continuous right-inverses to \(p\). We denote the global sections of \((E,p)\) by \(\Gamma((E,p))\).
\end{definition}

\begin{lemma}\label{lemma:global-sections-module}
  For every vector bundle \((E,p)\), \(\Gamma((E,p))\) is a \(C(X)\)-module.
\end{lemma}
\begin{proof}
  Let \(\sigma : X \to E\) be a section, and let \(c : X \to \R\) be an element of \(C(X)\). The scalar multiplication is given by \(c \cdot x := \lambda \hspace{2mm} z, c(z) \cdot s(z)\).\footnote{Note that here, the vector space structure on \(E_x\) is essential.}
\end{proof}

\begin{definition}\label{def:global-sections-functor}
  More generally, we define the \textbf{global sections functor}
  \[\Gamma : \Vect(X) \to C(X)\Mod\]
  as follows:
  \begin{itemize}
  \item On an object \((E,p)\), \(\Gamma((E,p))\) is the module of global sections of \((E,p)\), and
    \item On a map \(f : (E,p) \to (E',p')\), \(\Gamma(f) : \Gamma((E,p)) \to \Gamma((E',p'))\) is the map which sends a global section \(X \overset{\sigma}{\to} E\) to the global section \(X \overset{\sigma}{\to} E \overset{f}{\to} E'\).
    \end{itemize}

    \begin{proof}[\(\Gamma\) is functorial]
      We need to verify that \(\Gamma(\id) = \id\) and that for all vector bundle morphisms \(f,g\), \(\Gamma(g \circ f) = \Gamma(f) \circ \Gamma(g)\).
      \begin{itemize}
      \item If \((E,p) \to (E,p)\) is the identity of \((E,p)\), then for every global section \(\sigma : X \to E\) of \((E,p)\), \(\Gamma(\id)(\sigma) = \id \circ \sigma = \sigma\), so \(\Gamma\) is equal to \(\id\).

        \item If \((E,p) \overset{f}{\to} (E',p') \overset{g}{\to} (E'', p'')\) is a composition of vector bundle maps, then we see that for an arbitrary section \(\sigma : X \to E\), \(\Gamma(g \circ f)(\sigma) = g \circ f \circ \sigma = \Gamma(g)(\Gamma(f)(\sigma))\).
      \end{itemize}
    \end{proof}

    \begin{proof}[For every vector bundle map \(f : (E,p) \to (E',p')\), \(\Gamma(f)\) is \(C(X)\)-linear]
      We need to verify that \(\Gamma(f)\) is additive and that \(\Gamma(f)\) is \(C(X)\)-equivariant.
      \begin{itemize}
      \item Let \(\sigma_1, \sigma_2 : X \to E\) be global sections. Then
        \[\Gamma(f)(\sigma_1 + \sigma_2) = f \circ (\sigma_1 + \sigma_2) = \lambda x, f(\sigma_1 + \sigma_2)(x) = \lambda x, f(\sigma_1(x) + \sigma_2(x))\]\[ = \lambda x, f(\sigma_1(x)) + f(\sigma_2(x)) = \Gamma(f)(\sigma_1) + \Gamma(f)(\sigma_2).\]
        \item Let \(c \in C(X)\). Then \[\Gamma(f)(c \cdot \sigma) = \lambda x, f \circ (c(x) \cdot \sigma(x)) = c(x) \cdot (f(\sigma(x))) = c \cdot \Gamma(\sigma).\]
      \end{itemize}
    \end{proof}

\end{definition}

\begin{definition}\label{def:local-base}
  Let \((E,p)\) be a vector bundle over \(X\). Let \(x : X\). We define a \textbf{local base} for \((E,p)\) at \(x\) to be the following data:
  \begin{enumerate}[label={(\alph*)}]
  \item An open set \(U\), such that \(U \ni x\),
  \item Finitely many continuous local sections \(s_1, \dots, s_n : U \to E\), such that for every \(y \in U\), \(s_1(y), \dots, s_n(y)\) form a basis for \(E_y\).
  \end{enumerate}
\end{definition}

\begin{lemma}[Lemma 3, \cite{swan1962vector}]\label{lemma:section-extension}
  Let \((E,p)\) be a vector bundle over \(X\). Let \(x : X\), let \(U \ni x\) be a neighborhood, and let \(s : U \to E\) be a local section of \((E,p)\) on \(U\). Then there exists a global section \(s' : X \to E\) and a smaller neighborhood \(W \subseteq U\) such that \(s\) and \(s'\) agree on \(W\).
\end{lemma}

\begin{proof}
  Since \(X\) is compact Hausdorff, \(X\) is normal. Thus, we can find neighborhoods \(V\) and \(W\) of \(x\) such that \(\cl(W) \subseteq V\) and \(\cl(V) \subseteq U\). By \Cref{lemma:urysohn}, there exists a continuous function \(\omega : X \to \R\) such that \(\omega\) is \(1\) on \(\cl(W)\) and \(0\) on \(X \backslash V\).

  Then we define \(s'\) by putting \(s'(x) := \omega(x) \cdot s(x)\) (fiberwise scalar multiplication) when \(x \in U\), and \(s'(x) := 0\) when \(x \notin U\).
\end{proof}

\section{Projective modules}
Throughout this section, we fix a commutative ring \(R\).

\begin{definition} \label{def:left-exact}
  Let \(R\) and \(S\) be rings. We say that a functor \(F : R\Mod \to S\Mod\) is \textbf{left-exact} if it preserves \(0\) and direct sums, and for every short exact sequence \(0 \to A \overset{f_1}{\to} B \overset{f_2}{\to} C \to 0\) in \(R\Mod\),
  \[0 \to F(A) \overset{F(f_1)}{\to} F(B) \overset{F(f_2)}{\to} F(C)\]
  is a short exact sequence in \(S\Mod\)
\end{definition}

\begin{definition} \label{def:right-exact}
  Let \(R\) and \(S\) be rings. We say that a functor \(F : R\Mod \to S\Mod\) is \textbf{left-exact} if it preserves \(0\) and direct sums, and for every short exact sequence \(0 \to A \overset{f_1}{\to} B \overset{f_2}{\to} C \to 0\) in \(R\Mod\),
  \[F(A) \overset{F(f_1)}{\to} F(B) \overset{F(f_2)}{\to} F(C) \to 0\]
  is a short exact sequence in \(S\Mod\).
\end{definition}

\begin{lemma}\label{lemma:left-exact-finite-limits}
  \(F : R\Mod \to S\Mod\) is left exact if and only if \(F\) preserves finite limits.
\end{lemma}

\begin{lemma}\label{lemma:right-exact-finite-limits}
  \(F : R\Mod \to S\Mod\) is right exact if and only if \(F\) preserves finite colimits.
\end{lemma}

\begin{lemma}\label{lemma:covariant-hom-left-exact}
  Let \(M\) be an \(R\)-module. Then the covariant hom-functor \(\RHom{R}{M}{-}\) is left-exact.
\end{lemma}

\begin{proof}
  We need to show that for every exact sequence \(0 \to A \overset{f_1}{\to} B \overset{f_2}{\to} C \to 0\),
  \[0 \to \RHom{R}{M}{A} \overset{f_1 \circ -}{\to} \RHom{R}{M}{B} \overset{f_2 \circ -}{\to} \RHom{R}{M}{C}\]
  is exact.

  That is, we need to show that
  \begin{enumerate}
  \item \label{lemma:covariant-hom-left-exact-1}\(f_1 \circ -\) is injective.
  \item \label{lemma:covariant-hom-left-exact-2} \(\im(f_1 \circ -) = \ker(f_2 \circ -)\).
  \end{enumerate}

First, we prove  \Cref{lemma:covariant-hom-left-exact-1}.
    Let \(g_1, g_2 : M \to A\) such that \(f_1 \circ g_1 = f_1 \circ g_2\). By assumption on \(f_1\), \(f_1\) is injective, so it follows that \(g_1 = g_2\).

Now we prove \Cref{lemma:covariant-hom-left-exact-2}.
    Let \(g : M \to A\). Then \(f_2 \circ f_1 \circ g : M \to C\) is zero because \(f_2 \circ f_1\) is zero, which shows that \(\im(f_1 \circ -) \subseteq \ker(f_2 \circ -)\). For the other inclusion, let \(h : M \to B\)  such that \(f_2 \circ h = 0\). It suffices to exhibit a \(g : M \to A\) such that \(f_1 \circ g = h\). We define \(g\) pointwise. Fix \(m \in M\). Since \(f_2 \circ h = 0\), we have that \(\im(h) \subseteq \ker(f_2)\). By assumption on \(f_2\), \(\ker(f_2) = \im(f_1)\), so \(\im(h) \subseteq \im(f_1)\). That is, there exists some \(a \in A\) such that \(h(m) = f_1(a)\). We define \(g(m) = a\). Since \(f_1\) is injective, this function is well-defined and is easily checked to be an \(R\)-module homomorphism.

  \end{proof}

  \begin{definition}[\cite{nlab:projective_module}]\label{def:projective}
  Let \(M\) be an \(R\)-module. \(M\) is projective if it satisfies any of the following properties:

  \begin{enumerate}
  \item\label{projective-lifting} For any \(A, B\), \(f : M \to B\) and \(g : A \twoheadrightarrow B\), there exists a lift \(\widetilde{f}\):
    \[
      \begin{tikzcd}
        & A \arrow[two heads]{d}{g}\\
        M \arrow[dashed]{ur}{\widetilde{f}}\arrow[swap]{r}{f}& B
      \end{tikzcd}
    \]
  \item \label{projective-free-summand} \(M\) is a direct summand of a free module.

    \item \label{projective-split} Every short exact sequence \(0 \to A \to B \to M \to 0\) is split.

    \item \label{projective-hom-exact} The covariant hom-functor \(\Hom_{R\text{-Mod}}(M, -)\) is exact.
  \end{enumerate}
\end{definition}

\begin{lemma}\label{lemma:projective-equivalent}
  The properties \Cref{projective-lifting}, \Cref{projective-free-summand}, \Cref{projective-split}, and \Cref{projective-hom-exact} are equivalent.
\end{lemma}
\begin{proof}
  \begin{itemize}
  \item (\Cref{projective-lifting} \(\implies\) \Cref{projective-hom-exact})
    Let \(0 \to A \overset{f_1}{\to} B \overset{f_2}{\to} C \to 0\) be an exact sequence. We need to show that the following sequence is also exact:
    \[0 \to \RHom{R}{M}{A} \overset{f_1 \circ -}{\to} \RHom{R}{M}{B} \overset{f_2 \circ -}{\to} \RHom{R}{M}{C} \to 0.\]
    Left-exactness is exactly the conclusion of \Cref{lemma:covariant-hom-left-exact}.

    To show right-exactness, it suffices to show that \(f_2 \circ -\) is surjective. Fix \(h : M \to C\). By assumption, \(f_2\) is surjective. Then we are in the situation of \Cref{projective-lifting}, so there exists a lift \(\wt{h} : M \to B\) of \(h\) along \(f_2\) such that \(f_2 \circ \wt{h} = h\).

    \item (\Cref{projective-lifting} \(\implies\) \Cref{projective-split}) Suppose that \(0 \to A \to B \overset{f}{\to} M \to 0\) is exact. Then \(f\) is an epimorphism, so there exists a lift \(g\) of the identity \(\operatorname{id} : M \to M\) along the surjection \(f\), such that \(f \circ g = \operatorname{id}\), so the sequence is split.
    \item (\Cref{projective-split} \(\implies\) \Cref{projective-free-summand}) Write \(M\) as the quotient of a free module \(F \overset{\pi}{\twoheadrightarrow} M\). Then there is a short exact sequence
      \[ 0 \to \ker(\pi) \hookrightarrow F \overset{\pi}{\twoheadrightarrow} M \to 0 \]
      and by assumption it is split. By the splitting lemma, there is an isomorphism \(F \simeq \ker(\pi) \oplus M\), so \(M\) is a direct summand of a free module.
    \item (\Cref{projective-free-summand} \(\implies\) \Cref{projective-lifting}) Let \(f : M \to B\) and \(g : A \twoheadrightarrow B\) form a diagram as in \Cref{projective-lifting}. Since \(M\) is a direct summand of a free module, there exists a module \(N\) such that \(M \oplus N\) is free, so that we have the following picture:
      \[
        \begin{tikzcd}
         M \oplus N \arrow[two heads]{d}{\pi_1} \arrow[dashed]{r} & A \arrow[two heads]{d}{g} \\
         M \arrow[bend left]{u}{\iota_1} \arrow[swap]{r}{f} & B
        \end{tikzcd}
      \]
      The horizontal lift of \(f \circ \pi_1\) along \(g\) exists because we can (in general) lift maps from free modules along surjections (determined up to a choice of where basis elements are sent).
    \item (\Cref{projective-hom-exact} \(\implies\) \Cref{projective-lifting}) Let \(g : A \twoheadrightarrow B\). Then \(g\) fits into a short exact sequence
      \[
        0 \to \ker(g) \hookrightarrow A \overset{g}{\twoheadrightarrow} B \to 0
      \]
      and since \(\Hom(M,-)\) is exact, we have an exact sequence
      \[
        0 \to \Hom(M,\ker(g)) \hookrightarrow \Hom(M, A) \overset{g \circ -}{\twoheadrightarrow} \Hom(M, B) \to 0.
      \]
      Therefore, for any \(f : M \to B\), by the surjectivity of \(g \circ -\), there exists an \(\widetilde{f} : M \to A\) such that \(g \circ \widetilde{f} = f\).
  \end{itemize}
\end{proof}

\begin{lemma} \label{lemma:fg-projective-idempotent-aux}
  Let \(M_1 \oplus M_2 \simeq R^n\). Then there exists an idempotent \(e : \Mat_n(R)\) such that \(M_1 \simeq e(R^n)\).
\end{lemma}

\begin{proof}
  Let \(e\) be the matrix representing the linear transformation \(f_e : R^n \twoheadrightarrow M_1 \hookrightarrow R^n\).

  It suffices to show that \(f_e\) is an idempotent linear transformation and that its image is \(M_1\).

  To see that \(f_e\) is idempotent, let \(x : R^n\) and write \(x\) as \(x_1 + x_2\) according to the direct sum decomposition \(M_1 \oplus M_2 \simeq R^n\). Then \(e(x_1 + x_2) = e(x_1) + e(x_2) = x_1\), and so \(e^2(x) = e(x_1) = x_1 = e(x)\).

  To see that the image of \(f_e\) is \(M_1\), let \(x : R^n\), and note that \(f_e(x) = f_e(x_1 + x_2) = x_1\) (using the same notation as before), and so \(\im(f_e) \subseteq M_1\). Conversely, given an \(x_1 \in M_1\), we see that \(f_e(x_1) = x_1\), so \(M_1 \subseteq \im(f_e)\).
\end{proof}

\begin{lemma} \label{lemma:fg-projective-idempotent}
  Let \(M\) be a finitely-generated projective \(R\)-module . Then there exists an \(n\) and an idempotent \(e : \Mat_n(R)\) such that \(M \simeq e(R^n)\).
\end{lemma}

\begin{proof}
  This follows immediately from \Cref{lemma:fg-projective-idempotent-aux} and the definition \Cref{projective-free-summand} of projective.
\end{proof}

\begin{definition} \label{def:category-projective-modules}
  We define \(\fgProj(R)\) to be the full subcategory of \(R\text{-Mod}\) on the finitely-generated projective \(R\)-modules.
\end{definition}

\section{Swan's theorem}

Throughout this section, \(R\) denotes \(C(X)\), the ring of continuous functions on \(X\).

\begin{lemma}[\cite{swan1962vector}, Lemma 1]\label{lemma:1}
  Let \(x \in X\). Let \(E \overset{p}{\to} X\) be a vector bundle, and let \(t_1, \dots, t_k\) be sections of \(E\) over a neighborhood \(U \ni x\) such that \(t_1(x), \dots, t_k(x)\) are linearly independent.

  Then there is a neighborhood \(V \ni x\) such that for all \(y \in V\), \(t_1(y), \dots, t_k(y)\) are linearly independent.
\end{lemma}

\begin{proof}
  Without loss of generality, we may assume that \(U\) trivializes \(E\) at \(x\), and thus that we are in the situation of having continuous functions
  \[s_1, \dots, s_k : U \to \R^n\]
  such that \(s_1(x), \dots, s_k(x)\) are linearly independent.

  We identify \((s_1(x), \dots, s_k(x))\) with a linear transformation \(f_x : \R^k \to \R^n\). It suffices to show that there is a neighborhood \(V\) of \(x\) such that \(\mathbf{s} := (x \mapsto f_x)\) (which we claim is continuous) is injective on \(V\). Indeed, since \(f_x\) is continuous, there exists some left-inverse \(g\) of \(f_x\). Since the map
  \[(h \mapsto gh) : \Hom(\R^k, \R^n) \to \R\]
  is continuous, there exists a neighborhood \(V_0\) of \(f_x\) such that for every \(h \in V_0\), \(h\) is injective. Then we can take \(V = \mathbf{s}^{-1}(V_0)\).
\end{proof}

% TODO(jesse): add back in conditions on im(f)
\begin{lemma}[Proposition 1, \cite{swan1962vector}]\label{lemma:proposition-1}
  Let \(f : (E,p) \to (E',o')\) be a map of vector bundles over \(X\). Then the following are equivalent:
  \begin{enumerate}[label={(\alph*)}]
  \item \label{lemma:proposition-1-1} \(\ker f\) is a subbundle of \((E,p)\).
  \item \label{lemma:proposition-1-2} The dimensions of the fibers of \(ker f\) are locally constant.
  \end{enumerate}
\end{lemma}
\begin{proof}
  By \Cref{lemma:rank-locally-constant}, the rank of a bundle is locally constant, so by definition, \Cref{lemma:proposition-1-1} implies \Cref{lemma:proposition-1-2}. For the converse, we must exhibit trivialization data for \(\ker f\), so let \(x \in X\). We will obtain an open set \(U\) which trivializes \(\ker f\) at \(x\) as follows. Let \(n\) be the rank of \(E\) at \(x\). Since \((E,p)\) is a bundle, we can choose a local base \(\{s_1, \dots, s_n\}\) for \((E,p)\) at \(x\). There is a subset of these, say \(s_1, \dots, s_k\), such that \(f s_1, \dots, f s_k\) are a basis for \(\im(f)_{f(x)}\).

  %Let \(t_1, \dots, t_n\) be a local base for \(E'\) at \(x\). By traversing the \(t_i\) and renumbering, we can assume that \(fs_1, \dots, fs_k, t_{k+1}, \dots, t_n\) are linearly independent at \(x\). Applying \Cref{lemma:1} and the fact that the rank of \(E'\) is locally constant, we conclude that \(fs_1, \dots, fs_k, t_{k+1}, \dots, t_n\) form a local base for \(E'\) at \(f(x)\).

  It follows that there is a neighborhood \(U \ni x\) such that for all \(y \in U\), and for every \(i > k\), \(f \circ s_i(y) = \sum_{j = 1}^k a_{ij}(y) \cdot f \circ s_j(y).\) Then for every \(i\),
  \[\left( s_i'(y) := s_i(y) - \sum_{j = 1}^k a_{ij}(y)s_j(y) \right) : (\ker f)_y,\]
  and the $\{s'_{k+1}, \cdots, s'_{n}\}$ form a local base for \(\ker(f)\) near \(x\), as required.
\end{proof}

\begin{lemma}\label{lemma:proposition-1-aux}
  Let \(f : (E,p) \to (E', o')\) be a map of vector bundles over \(X\). For every \(x : X\), there exists a neighborhood \(U\) such that for all \(y \in U\), \(\dim(\im(f)_y) \geq \dim(\im(f)_x)\).
\end{lemma}

\begin{proof}
  Let \(s_1, \dots, s_m\) be a local base for \(E\) at \(x\). Let \(k = \dim(\im(f)_{f(x)})\). We renumber the \(s_i\) so that \(fs_k(x), \dots, fs_k(x)\) form a basis for \(\im(f)_{f(x)}\). Since the \(s_1, \dots, s_n\) are a local base, there exists a neighborhood \(U\) of \(x\) such that for all \(y \in U\), \(\{fs_1y, \dots, fs_ky\}\) form a basis for \(\im(f)_{f(y)}\). By Lemma \(1\), \(s_1, \dots, s_k\) are independent at \(y \in V\) for \(V \subseteq U\), and the inequality follows.
\end{proof}


\begin{lemma}[Proposition 2, \cite{swan1962vector}; Proposition 1.3, \cite{hatcher2003vector}] \label{lemma:proposition-2}
  Any subbundle \((E_0, p|_{E_0})\)of a vector bundle \((E,p)\) over \(X\) is a direct summand.
\end{lemma}

\begin{proof} % TODO(jesse): come back and make this more detailed
  An \emph{inner product} on \((E,p)\) is an inner product \(\langle -,- \rangle_x\) on each of the fibers \(E\) which varies continuously over the basepoint \(x\) (equivalently, one could rephrase this in terms of extra conditions on the triviality data requiring preservation of the inner product structure). We claim that it is sufficient to show that \((E,p)\) can be equipped with an inner product. Indeed, by taking fiberwise orthogonal projections, we obtain a vector bundle map \(\pi : (E, p) \twoheadrightarrow (E_0, p|_{E_0})\). Since \(\langle -,- \rangle_x\) varied continuously in \(x\), the dimensions of the fibers of \(\ker \pi = (E', p|_{E'})\) are locally constant, so by \Cref{lemma:proposition-1}, \((E', p|_{E'})\) is a vector subbundle of \((E,p)\); by construction, \((E_0, p_{E_0}) \oplus (E', p_{E'}) \simeq (E,p)\).

  It remains to show that an inner product can always be constructed on \((E,p)\). This follows from \Cref{lemma:subordinate-partition-of-unity}: since \(X\) is compact Hausdorff, there exists a finite trivializing cover \(U_1, \dots, U_n\), such that over each \(U_i\), there is a \(k_i\) such that the pullback of \((E,p)\) along the inclusion \(U_i \hookrightarrow X\) is isomorphic to a trivial bundle of rank \(k_i\) (i.e. \(X \times \mathbb{R}^k\)). Fix an inner product \(\langle -,- \rangle_i\) on each \(\mathbb{R}^{k_i}\). Since \(X\) is compact Hausdorff, there exists a partition of unity \(g_1, \dots, g_n\) subordinate to \(U_1, \dots, U_n\). Then \(\langle -,- \rangle_x = \sum_{i \leq n} g_i(x) \langle -,- \rangle^0_{i}\) is an inner product on \((E,p)\).
\end{proof}

\begin{lemma}\label{lemma:global-sections-trivial-fg}
  Let \(\mathbf{E} := (X \times \R^n, \pi_1)\) be a trivial bundle over \(X\). Then \(\Gamma(\mathbf{E})\) is a free \(R\)-module on \(n\) generators.
\end{lemma}

\begin{proof}
  We may identify sections of \(E\) with continuous functions \(X \to \mathbb{R}^n\). We abuse notation by identifying a standard basis vector \(e_i\) with the constant function \(\lambda\ x, e_i\). We claim that \(e_1, \cdots, e_n\) form an \(R\)-basis for \(\Gamma(\mathbf{E})\). We must check that they span and are independent.
  \begin{proof}[Spanning.]
    Let \(f : X \to \R^n\) be continuous. For each standard basis vector \(e_i\), let \(c_i : X \to \R\) be \(p_i \circ f\), where \(p_i\) is the orthogonal projection onto \(e_i\). (Alternately, we could phrase this in terms of inner products). Then \(f = \sum_i c_i \cdot e_i\).
  \end{proof}

  \begin{proof}[Independence.]
    Let \(c_1, \cdots, c_n : R\). Suppose that \(c_1 \cdot e_1 + \cdots + c_n \cdot e_n = 0\). Then for every \(x : X\), \(c_1(x) \cdot e_1 + \cdots c_n(x) \cdot e_n = 0\). Since the \(e_1, \dots, e_n\) form a basis for \(\R^n\), for every \(i\), \(c_i(x) = 0\). Since \(x\) was arbitrary, it follows from function extensionality that \(c_1 = \cdots = c_n = 0\).
  \end{proof}
\end{proof}

\begin{lemma}[Corollary 2, \cite{swan1962vector}]\label{lemma:global-sections-faithful}
  The global sections functor is faithful.
\end{lemma}

\begin{proof}
  Let \((E,p)\) and \((E',p')\) be vector bundles over \(X\). Let \(f,g : (E,p) \to (E',p')\) be vector bundle maps. Suppose that \(\Gamma(f) = \Gamma(g)\). To show \(f = g\), it suffices by function extensionality to show that for all \(e : E\), \(f(e) = g(e)\). Let \(e : E\). Let \(x = p(e)\). By local triviality, there exists a local section \(\sigma : U \to E\) of \(x\) such that \(\sigma(x) = e\). By \Cref{lemma:section-extension}, we can extend \(\sigma\) to a global section such that \(\sigma (x) = e\). Since \(\Gamma(f) = \Gamma(g)\), \(f \circ \sigma = g \circ \sigma\), and so \(f(e) = f \circ \sigma(x) = g \circ \sigma(x) = g(e)\), as required.
\end{proof}

\begin{lemma}\label{lemma:localization-1}
  Let \((E,p)\) be a vector bundle over \(X\). Let \(\mathfrak{m}_x\) be the maximal ideal of \(R\) comprising those functions which vanish at \(x\). Let \(M_x(E)\) be the \(R\)-submodule of \(\Gamma((E,p))\) comprising those sections which vanish on \(x\). Then \(\mathfrak{m}_x \Gamma((E,p)) = M_x(E)\).
\end{lemma}

\begin{proof}
  To see that \(\mathfrak{m}_x \Gamma((E,p)) \subseteq M_x(E)\), let \(c \cdot \rho\) be a basic member of \(\mathfrak{m}_x \Gamma((E,p))\). This obviously vanishes at \(x\) because \((c \cdot \rho)(x) = c(x) \cdot \rho(x)\) and \(c(x) = 0\) by assumption. Therefore it belongs to \(M_x(E)\). By linearity, all members of \(\mathfrak{m}_x \Gamma((E,p))\) belong to \(M_x(E)\).

  To see that \(M_x(E) \subseteq \mathfrak{m}_x \Gamma((E,p))\), we must show that for an arbitrary global section \(\rho : X \to E\) which vanishes on \(X\), there exist finitely many \(c_1, \dots, c_n \in \mathfrak{m}_x\) and global sections \(\rho_1, \dots, \rho_n\) such that \(\rho = \sum_{0 \leq i \leq n} c_i \rho_i\). Let \(\rho_1, \dots, \rho_n\) be (global extensions, gotten by \Cref{lemma:section-extension}, of) a local base for \((E,p)\) at \(x\), so that near \(x\), there exist coordinate functions \(b_1, \dots, b_n\) such that \(\rho = \sum_i b_i \cdot \rho_i\). By applying \Cref{lemma:section-extension}, we can extend \(b_1, \dots, b_n\) to global coordinate functions \(b'_1, \dots, b'_n : X \to \mathbb{R}\) extending the \(b_i\). Then \(\sum b'_i \rho_i\) is a global section of \((E,p)\), and \(\rho - \sum b'_i \rho_i\) is a global section of \((E,p)\) which vanishes on a neighborhood \(U\) of \(x\). Since \(X\) is compact Hausdorff, by Urysohn's lemma \Cref{lemma:urysohn}, there exists a smaller neighborhood \(V \ni x\) such that \(\operatorname{cl}(V) \subseteq U\), and an interpolating function \(c : X \to \mathbb{R}\) such that \(c\) vanishes at \(x\) but is \(1\) on \(X \backslash V\).

  Then \(\rho = c \cdot \left(\rho - \sum_i b'_i \rho_i \right) + \sum_i b'_i \rho_i\); all coefficient functions in this \(R\)-linear combination of global sections vanish at \(x\), as required.
\end{proof}

\begin{lemma}\label{lemma:localization-2}
  Let \((E,p)\) be a vector bundle over \(X\). Let \(x : X\). The evaluation map \(\sigma \mapsto \sigma(x)\) descends to an \(R\)-module isomorphism
  \[
    \Gamma((E,p))/M_x(E) \simeq (E,p)_x.
  \]
\end{lemma}

\begin{proof}
  Immediate.
\end{proof}

\begin{lemma}[Theorem 1, \cite{swan1962vector}]\label{lemma:global-sections-full}
  The global sections functor is full.
\end{lemma}

\begin{proof}
  Let \((E,p)\) and \((E',p')\) be vector bundles over \(X\). Let \(f : \Gamma((E,p)) \to \Gamma((E',p'))\). Let \(x : X\).

  Immediately, we see that \(f\) descends to an \(R\)-module map \[f_x : \Gamma((E,p))/\mathfrak{m}_x \Gamma((E,p)) \to \Gamma((E',p'))/\mathfrak{m}_x \Gamma((E',p)).\]
  By \Cref{lemma:localization-1}, we obtain a map
  \[
f_x : \Gamma((E,p))/M_x(E) \to \Gamma((E',p'))/M_x(E').
\]
By \Cref{lemma:localization-2}, we then get a map on fibers
\[
f_x : (E,p)_x \to (E',p')_x,
\]
which is \(R\)-linear, so by restriction of scalars is also \(\R\)-linear.
whose disjoint union \(\widetilde{f}\) is a map \(E \to E'\). By construction, \(\widetilde{f}\) is \(\R\)-linear on fibers, and it remains to verify that \(\widetilde{f}\) is continuous.

Note that by function extensionality, for every \(\sigma : \Gamma((E,p))\), \(\widetilde{f} \circ \sigma\) = \(f (\sigma)\).

Since continuity is a local property, it suffices to fix \(e : E\) and verify it near \(e\). Let \(s_1, \dots, s_n\)be a local base of \((E,p)\) at \(p(e)\). Then for all \(e'\) near \(e\), \(e' = \sum_{i \leq n} c_i(e') s_i(p(e'))\), where \(c_1, \dots, c_n : R\), and
\[
  \widetilde{f}(e') = \sum_{i \leq n} c_i(e') \widetilde{f}(s_i(p(e'))) = \sum_{i \leq n} c_i(e') (f(s_i))(p(e'))
\]
is a sum of continuous functions in \(e'\).
\end{proof}

\begin{lemma}[Lemma 5, \cite{swan1962vector}]\label{lemma:free-resolution}
  Let \((E,p)\) be a vector bundle over \(X\). Then there exists a trivial vector bundle \(X \times \R^n \overset{\pi_1}{\to} X\) and a vector bundle epimorphism \((X \times \R^n) \twoheadrightarrow E\).
\end{lemma}

\begin{proof}
  For every \(x\), let \(U_x\) and \(\sigma^x_1, \cdots, \sigma^x_{k(x)}\) be a local base (\Cref{def:local-base}) for \((E,p)\) at \(x\). By \Cref{lemma:section-extension}, we may shrink \(U_x\) and extend \(\sigma^x_1, \cdots, \sigma^x_{(k(x))}\) to global sections. Since \(X\) is compact, finitely many \(U_x\), say \(U_1, \cdots, U_m\), suffice to cover \(X\). Let \(s_1, \cdots, s_n\) be the union of the global sections attached to each \(U_i\). By construction, for every \(x : X\), \(s_1(x), \cdots, s_n(x)\) span \(E_x\). Sending \(e_i \mapsto s_i\) yields an \(R\)-module map \(\Gamma((X \times \R^n, \pi_1)) \twoheadrightarrow \Gamma((E,p))\). By the fullness of the global sections functor (\Cref{lemma:global-sections-full}), this is induced by a bundle epimorphism \((X \times \R^n, \pi_1) \twoheadrightarrow (E,p)\).
\end{proof}

% TODO(jesse): there's a quantifier missing somewhere in the definition of local base in the notes; fix this

\begin{lemma}
  \label{lemma:global-sections-projective}
  Let \((E,p)\) be a vector bundle over \(X\). Then \(\Gamma((E,p))\) is a projective \(R\)-module.
\end{lemma}

\begin{proof}
  By \Cref{def:projective}, it suffices to show that every vector bundle over \(X\) is a direct summand of a trivial bundle over \(X\). Let \((E,p)\) be a vector bundle over \(X\). By \Cref{lemma:free-resolution}, there exists some trivial bundle \(X \times \R^n \twoheadrightarrow X\) and an epimorphism \(f : X \times \R^n \twoheadrightarrow E\). Let \(\eta\) be the kernel of this epimorphism. By \Cref{lemma:proposition-2}, \(\eta\) is a direct summand of \(X \times \R^n\), so there is some \(\eta'\) such that \(X \times \R^n \simeq \eta \oplus \eta'\). Let \(\iota_2 : \eta' \hookrightarrow \eta \oplus \eta'\) be the canonical inclusion. Then it is easy to check that \(f \circ \iota_2\) is an isomorphism \(\eta' \simeq (E,p)\).
\end{proof}

\begin{lemma}\label{lemma:global-sections-fg}
  Let \((E,p)\) be a vector bundle over \(X\). Then \(\Gamma((E,p))\) is a finitely-generated \(R\)-module.
\end{lemma}

\begin{proof}
  By \Cref{lemma:free-resolution}, there is a trivial bundle \((X \times \R^n, \pi_1)\) equipped with a vector bundle epimorphism onto \((E,p)\). This induces an \(R\)-module epimorphism \(\Gamma((X \times \R^n, \pi_1)) \twoheadrightarrow \Gamma((E,p))\). By \Cref{lemma:global-sections-trivial-fg}, \(\Gamma((X \times \R^n, \pi_1))\) is a free \(R\)-module of dimension \(n\), and the image of its basis in \(\Gamma((E,p))\) is a finite generating set for \(\Gamma((E,p))\).
\end{proof}

\begin{lemma}\label{lemma:global-sections-additive}
  The global sections functor is additive.
\end{lemma}

\begin{proof}
  Note that the initial object in \(\mathbf{Vect}(X)\) is the zero-dimensional trivial bundle over \(X\) (since \(0\) must be sent to \(0\) on all fibers). We must verify that:
  \begin{enumerate}

  \item \label{global-sections-preserves-zero} \(\Gamma(0) \simeq 0\), and
  \item \label{global-sections-preserves-direct-sum} \(\Gamma(\mathbf{E}_1 \oplus \mathbf{E}_2) \simeq \Gamma(\mathbf{E}_1) \oplus \Gamma(\mathbf{E}_2)\).
  \end{enumerate}

  \begin{proof}[Proof of \Cref{global-sections-preserves-zero}]
    Since the zero-dimensional trivial bundle over \(X\) is \(X \times \{0\} \simeq X\), there is a unique global section to \(X \times \{0\} \overset{\pi_1}{\twoheadrightarrow} X\), i.e. the constant map to \(0\). \(\Gamma(0) \simeq 0\), as required.
  \end{proof}

  \begin{proof}[Proof of \Cref{global-sections-preserves-direct-sum}]
    This is essentially because in \(\mathbf{Vect}(X)\), direct sum is computed fiberwise. We construct the isomorphism as follows. Let \(\rho : X \to E_1 \oplus E_2\) be be a global section to \(\mathbf{E}_1 \oplus \mathbf{E}_2\). Let \(P_1 : \mathbf{E}_1 \oplus \mathbf{E}_2 \twoheadrightarrow \mathbf{E}_1\) and \(P_2 : \mathbf{E}_1 \oplus \mathbf{E}_2 \twoheadrightarrow \mathbf{E}_2\) be the canonical projections. Then since the map from the total space \(E_1 \oplus E_2 \to X\) is the direct sum of the maps \(p_1 : E_1 \to X\) and \(p_2 : E_2 \to X\), \(P_1 \circ \rho : X \to E_1\) is a global section to \(E_1\) (resp., \(P_2 \circ \rho\) is a global section to \(E_2\)). This yields a map \(F : \Gamma(\mathbf{E}_1 \oplus \mathbf{E}_2) \to \Gamma(\mathbf{E}_1) \oplus \Gamma(\mathbf{E}_2)\) which is easily seen to be a homomorphism of \(R\)-modules. It is injective: if \(F(\rho_1) = F(\rho_2)\), then by construction of \(F\) \(\rho_1\) and \(\rho_2\) are equal after projecting to either \(E_1\) or \(E_2\). It is surjective: for any pair of global sections \(\xi_1 \in \Gamma(\mathbf{E}_1), \xi_2 \in \Gamma(\mathbf{E}_2)\), the pointwise direct sum \((\xi_1, \xi_2) : X \to E_1 \oplus E_2\) is a global section to \(\mathbf{E}_1 \oplus \mathbf{E}_2\).

  \end{proof}
\end{proof}

\begin{lemma}\label{lemma:global-sections-left-exact}
  The global sections functor is left-exact.
\end{lemma}

\begin{proof}
  It suffices to show that there exists a vector bundle \(\mathbf{G}\) over \(X\) such that there is a natural isomorphism of functors \(\Gamma(-) \simeq \Hom_{\mathbf{Vect}(X)}(\mathbf{G}, -) \), from which the claim follows by the easily-checked general fact that covariant hom-functors $\mbf{C}(A, -)$ preserve small limits.

  We use \(\mathbf{G} :=\) the trivial line bundle. The natural isomorphism is constructed as follows: given a vector bundle \((E,p)\), a global section entails a choice of a point \(y_x\) in \(E_x\) for every \(x \in X\). Then \(y_x \in \mathbb{R}^n\) induces a canonical map \(\mathbb{R}^1 \to \mathbb{R}^n\) by scalar multiplication. The totality of these maps yield a vector bundle map \(\mathbf{G} \to (E,p)\). Conversely, every vector bundle map \(\mathbf{G} \to (E,p)\) yields a global section of \((E,p)\) by the continuity of evaluating at \(1 \in \mathbb{R}\). This construction is easily checked to satisfy the required naturality diagram.
\end{proof}

\begin{lemma}\label{lemma:global-sections-essentially-surjective-aux}
  The global sections functor
    \[\Gamma : \Vect(X) \longrightarrow \fgProj(X)\]
  is essentially surjective on finitely-generated free modules.
\end{lemma}

\begin{proof}
  Fix \(n\). One checks that for the rank-\(n\) trivial bundle \(F\), \(\Gamma(F) \simeq C(X)^n = R^n\). Since every finitely-generated free module is isomorphic to \(R^n\) for some \(n\), \(\Gamma\) is essentially surjective on finitely-generated free modules.
\end{proof}

\begin{lemma}\label{lemma:global-sections-essentially-surjective}
  The global sections functor
  \[\Gamma : \Vect(X) \longrightarrow \fgProj(X)\]
  is essentially surjective.
\end{lemma}
\begin{proof}
  Let \(P\) be a finitely-generated projective module. By \Cref{lemma:fg-projective-idempotent}, there exists a free module \(F\) of rank \(n\), and an idempotent \(e : F \to F\), such that \(P = e(F)\). By \Cref{lemma:global-sections-essentially-surjective-aux}, there exists a trivial rank \(n\) bundle \(\widetilde{F} \simeq (X \times \R^n, \pi_1)\) such that \(\Gamma(\widetilde{F}) \simeq F\). By \Cref{lemma:global-sections-full} and \Cref{lemma:global-sections-faithful}, \(e : F \to F\) lifts uniquely to a vector bundle endomorphism \(\widetilde{e} : \widetilde{F} \to \widetilde{F}\).

  To finish the proof, it suffices to show that \(\Gamma(\im(\widetilde{e})) \simeq P\). To prove this, we first show that it suffices to show that \(\ker(\widetilde{e})\) is a subbundle of \(\widetilde{F}\). Suppose that \(\ker(\widetilde{e})\) is a subbundle. Then by \Cref{lemma:proposition-1}, \(\im(\widetilde{e})\) is also a subbundle, and so in \(\Vect(X)\) we have a split exact sequence
  \[
0 \to \ker(\widetilde{e}) \to \widetilde{F} \to \im(\widetilde{e}) \to 0.
  \]
  Since \(\Gamma\) is an additive functor by \Cref{lemma:global-sections-additive}, applying \(\Gamma\) yields a split exact sequence in \(\fgProj(X)\):
  \[
0 \to \Gamma(\ker(\widetilde{e})) \to \Gamma(\widetilde{F}) \to \Gamma(\im(\widetilde{e})) \to 0.
\]
Since \(\Gamma\) is left-exact by \Cref{lemma:global-sections-left-exact}, we have the following commutative diagram, where \(\Psi\) and \(\Phi\) are isomorphisms and the dashed arrow \(g\) is the composition \(\pi_2 \circ \Phi^{-1} \circ \sigma\):
\[
  \begin{tikzcd}
    & \ker(e) \arrow[swap]{dd}{\Psi} \arrow{r}& F \arrow[swap]{dd}{\Phi} \arrow{r}{\pi_2} & \im(e) \arrow{rd}& \\
  0 \arrow{ur} \arrow{dr}  & & & & 0\\
    & \Gamma(\ker(\widetilde{e})) \arrow{r}& \Gamma(\ker(\widetilde{e})) \oplus \Gamma(\im(\widetilde{e})) \arrow{r} & \Gamma(\im(\widetilde{e})) \arrow[swap, shift right = 1ex]{l}{\sigma} \arrow[dashed]{uu}{g} \arrow{ru} &
  \end{tikzcd}
\]
One checks that \(g\) is inverted by the reverse composition, and is therefore an isomorphism: \(\im(\widetilde{e})\) is a lift for \(\im(e)\), as required.

To show that \(\im(\widetilde{e})\) is a subbundle of \(\widetilde{F}\), we apply \Cref{lemma:proposition-1} to reduce this to showing that the dimensions of the fibers of \(\im(\widetilde{e})\) are locally constant. Let \(x : X\). Let \(h := \dim (\im(\widetilde{e})_x)\) and let \(k := \dim(\ker(\widetilde{e}))_x\). Since \(\widetilde{e}^2 = \widetilde{e}\), \(\ker(\widetilde{e}) = \im(\id - \widetilde{e})\). By applying \Cref{lemma:proposition-1-aux} to \(\im(\widetilde{e})\) and \(\im(\id - \widetilde{e})\), there exists a neighborhood \(U\) of \(x\) such that for all \(y \in U\), \(\dim(\im(\widetilde{e})_y \geq h\) and \(\dim(\ker(\widetilde{e})_y) \geq k\).

Since \(\widetilde{F}\) is a trivial vector bundle of rank \(n\), we have that for all \(y \in U\), \(\dim(\widetilde{F}_y) = n\). Since we also have that \(\widetilde{F}_y \simeq \im(\widetilde{e})_y \oplus \ker(\widetilde{e})_y\), it follows that \(h + k = n\). Therefore, \(\dim(\im(\widetilde{e})_y = h\) and \(\dim(\ker(\widetilde{e})_y) = k\). We conclude that the rank of the fibers of \(\im(\widetilde{e})\) is locally constant.
\end{proof}

%TODO(jesse): maybe explicitly construct and name the inverse functor?
\begin{theorem}[Swan, \cite{swan1962vector}] \label{thm:swan}
  The global sections functions induces an equivalence of categories
  \[\Gamma : \Vect(X) \overset{\sim}{\longrightarrow} \fgProj(X).\]
\end{theorem}

\begin{proof}
  By \Cref{lemma:global-sections-full}, \Cref{lemma:global-sections-faithful}, and \Cref{lemma:global-sections-essentially-surjective}, \(\Gamma\) is full, faithful, and essentially surjective, and is therefore an equivalence of categories.
\end{proof}

% TODO(jesse): come back to this later

% \section{Kaplansky's theorem on projective modules over local rings}

% \begin{definition}\label{def:local-ring}
%   Let \(R\) be a commutative ring. \(R\) is \textbf{local} if it has a unique maximal ideal.
% \end{definition}

% \begin{definition}\label{def:free-module}
%   Let \(R\) be a commutative ring. Let \(M\) be an \(R\)-module. \(M\) is \textbf{free} if \(M\) has a basis; equivalently, if \(M\) is isomorphic to a direct sum of copies of \(R\).
% \end{definition}

% \begin{theorem}[Kaplansky]\label{thm:kaplansky}
%   Let \(R\) be a local ring, and let \(M\) be a projective module over \(R\). Then \(M\) is free.
% \end{theorem}

% \begin{proof}
%   \TODO(jesse)
% \end{proof}

% \section{Internalizing Kaplansky's theorem to \(\Shv(X)\)}

\bibliography{swan-notes}

\end{document}